#include "shared.h"

// Keep all inputs together
typedef struct
{
    bool emergencyStop;
    bool hasNewConfiguration;
    configuration_t newestConfiguration;
    unsigned long clock;
} state_inputs_t;

const full_state_t testStatesInitial[17] = {{{{1, 1, 1}, {1, 1, 1}, {1, 1, 1}}, 1, 2}, {{{1, 1, 1}, {1, 1, 1}, {1, 1, 1}}, 1, 4}, {{{1, 1, 1}, {1, 1, 1}, {1, 1, 1}}, 1, 3}, {{{3, 3, 3}, {3, 3, 3}, {3, 3, 3}}, 1, 4}, {{{3, 3, 3}, {3, 3, 3}, {3, 3, 3}}, 1, 1}, {{{2, 2, 2}, {2, 2, 2}, {2, 2, 2}}, 1, 4}, {{{3, 3, 3}, {3, 3, 3}, {3, 3, 3}}, 1, 1}, {{{2, 2, 2}, {2, 2, 2}, {2, 2, 2}}, 1, 1}, {{{1, 1, 1}, {1, 1, 1}, {1, 1, 1}}, 1, 9}, {{{1, 1, 1}, {1, 1, 1}, {1, 1, 1}}, 1, 4}, {{{1, 1, 1}, {1, 1, 1}, {1, 1, 1}}, 1, 4}, {{{1, 1, 1}, {1, 1, 1}, {1, 1, 1}}, 1, 4}, {{{1, 1, 1}, {1, 1, 1}, {1, 1, 1}}, 1, 1}, {{{2, 2, 2}, {2, 2, 2}, {2, 2, 2}}, 1, 9}, {{{8, 8, 8}, {8, 8, 8}, {8, 8, 8}}, 1, 4}, {{{3, 3, 3}, {3, 3, 3}, {3, 3, 3}}, 1, 4}, {{{9, 9, 9}, {9, 9, 9}, {9, 9, 9}}, 2, 2}};
const full_state_t testStatesExpected[17] = {{{{1, 1, 1}, {1, 1, 1}, {1, 1, 1}}, 1, 2}, {{{1, 1, 1}, {1, 1, 1}, {1, 1, 1}}, 1, 2}, {{{1, 1, 1}, {1, 1, 1}, {1, 1, 1}}, 1, 3}, {{{0, 0, 0}, {0, 0, 0}, {0, 0, 0}}, 1, 4}, {{{3, 3, 3}, {3, 3, 3}, {3, 3, 3}}, 1, 1}, {{{3, 3, 3}, {3, 3, 3}, {3, 3, 3}}, 1, 4}, {{{4, 4, 4}, {4, 4, 4}, {4, 4, 4}}, 1, 1}, {{{2, 2, 2}, {2, 2, 2}, {2, 2, 2}}, 1, 1}, {{{1, 1, 1}, {1, 1, 1}, {1, 1, 1}}, 1, 9}, {{{1, 1, 1}, {1, 1, 1}, {1, 1, 1}}, 1, 4}, {{{1, 1, 1}, {1, 1, 1}, {1, 1, 1}}, 1, 4}, {{{1, 1, 1}, {1, 1, 1}, {1, 1, 1}}, 1, 4}, {{{1, 1, 1}, {1, 1, 1}, {1, 1, 1}}, 1, 1}, {{{2, 2, 2}, {2, 2, 2}, {2, 2, 2}}, 1, 9}, {{{8, 8, 8}, {8, 8, 8}, {8, 8, 8}}, 1, 4}, {{{3, 3, 3}, {3, 3, 3}, {3, 3, 3}}, 1, 4}, {{{9, 9, 9}, {9, 9, 9}, {9, 9, 9}}, 1, 2}};
const inputs_t testInputs[17] = {{false, true, {{10, 10, 10}, {10, 10, 10}, {10, 10, 10}}, 1}, {true, true, {{7, 7, 7}, {7, 7, 7}, {7, 7, 7}}, 3}, {true, true, {{3, 3, 3}, {3, 3, 3}, {3, 3, 3}}, 3}, {false, false, {{6, 6, 6}, {6, 6, 6}, {6, 6, 6}}, 8}, {true, false, {{9, 9, 9}, {9, 9, 9}, {9, 9, 9}}, 8}, {false, false, {{5, 5, 5}, {5, 5, 5}, {5, 5, 5}}, 6}, {false, false, {{6, 6, 6}, {6, 6, 6}, {6, 6, 6}}, 2}, {true, true, {{7, 7, 7}, {7, 7, 7}, {7, 7, 7}}, 4}, {true, true, {{4, 4, 4}, {4, 4, 4}, {4, 4, 4}}, 9}, {false, true, {{9, 9, 9}, {9, 9, 9}, {9, 9, 9}}, 7}, {true, false, {{8, 8, 8}, {8, 8, 8}, {8, 8, 8}}, 5}, {true, true, {{7, 7, 7}, {7, 7, 7}, {7, 7, 7}}, 4}, {true, false, {{10, 10, 10}, {10, 10, 10}, {10, 10, 10}}, 2}, {false, false, {{5, 5, 5}, {5, 5, 5}, {5, 5, 5}}, 8}, {true, true, {{8, 8, 8}, {8, 8, 8}, {8, 8, 8}}, 1}, {true, false, {{10, 10, 10}, {10, 10, 10}, {10, 10, 10}}, 7}, {true, false, {{3, 3, 3}, {3, 3, 3}, {3, 3, 3}}, 1}};
const int numTests = 17;

bool testTransition(full_state_t start, full_state_t end, state_inputs_t inputs, bool verbos)
{
    const auto actual = updateFSM(start, inputs.clock, inputs.emergencyStop, inputs.hasNewConfiguration, inputs.newestConfiguration);

    bool passedTest = (actual == end);

    if (!verbos)
    {
        return passedTest;
    }
    else if (passedTest)
    {
        // Serial.println("Passed some test");
        return true;
    }
    else
    {
        // Serial.println("todo!() failed but fill in info");
    }
}